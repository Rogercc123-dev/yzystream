<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YZY News Generator</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      padding: 2rem;
    }
    input, button {
      padding: 0.6rem;
      font-size: 1rem;
      margin: 0.5rem 0;
      width: 100%;
      max-width: 600px;
    }
    button {
      background: white;
      color: black;
      cursor: pointer;
      border: none;
    }
    .status {
      margin-top: 1rem;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>üì∞ YZY Stream ‚Äî News Page Generator</h1>
  <p>Paste a <strong>Kanye Wiki</strong> link below. Example:<br>
    <code>https://kanyewest.fandom.com/wiki/LOVE_EVERYONE</code></p>
  <input id="urlInput" type="text" placeholder="Paste Kanye Wiki URL here..." />
  <button onclick="generate()">Generate & Download HTML</button>
  <div class="status" id="status">Ready</div>

  <script>
    async function generate() {
      const url = document.getElementById('urlInput').value.trim();
      const status = document.getElementById('status');
      status.textContent = 'Fetching...';

      if (!url.startsWith('http')) {
        status.textContent = '‚ùå Invalid URL.';
        return;
      }

      try {
        const proxy = 'https://api.allorigins.win/get?url=';
        const res = await fetch(proxy + encodeURIComponent(url));
        const data = await res.json();
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');

        const title = doc.querySelector('h1.page-header__title')?.innerText || 'Untitled';
        const safeTitle = title.replace(/\s+/g, '_');
        const contentBlock = doc.querySelector('.mw-parser-output');

        contentBlock.querySelectorAll('.mw-editsection, script, style, .reference, sup').forEach(el => el.remove());

        contentBlock.querySelectorAll('img').forEach(img => {
          let src = img.getAttribute('data-src') || img.getAttribute('src');
          if (src?.startsWith('//')) src = 'https:' + src;
          img.setAttribute('src', src);
          img.setAttribute('loading', 'lazy');
          img.style.maxWidth = '100%';
          img.style.borderRadius = '8px';
        });

        const articleHTML = contentBlock.innerHTML;

        const finalHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://pagead2.googlesyndication.com https://pl26524932.profitableratecpm.com 'unsafe-inline'; style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; font-src 'self' https://cdnjs.cloudflare.com; img-src * data:;">
  <title>${title} - YZY STREAM</title>

  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/ibm-plex/6.0.0/css/ibm-plex-mono.min.css" as="style">
  <link rel="preload" href="style.css" as="style">
  <link rel="preload" href="clock.js" as="script">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/ibm-plex/6.0.0/css/ibm-plex-mono.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <script src="clock.js" defer></script>

  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="web-app-manifest-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="web-app-manifest-512x512.png">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#ffffff" />

  <meta name="description" content="${title} - News article about Kanye West.">
  <meta name="keywords" content="Kanye West, Ye, Kanye Wiki, News, YZY Stream, ${title}">
  <meta name="author" content="YZY Stream Admin">

  <meta property="og:title" content="${title} - YZY STREAM" />
  <meta property="og:description" content="News: ${title}" />
  <meta property="og:image" content="https://yzystream.com/logo.png" />
  <meta property="og:url" content="https://yzystream.com/news/${safeTitle}.html" />
  <meta property="og:type" content="article" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="${title} - YZY STREAM" />
  <meta name="twitter:description" content="News article about Kanye West: ${title}" />
  <meta name="twitter:image" content="https://yzystream.com/logo.png" />
</head>
<body>
  <div class="content-wrapper">
    <header>
      <h1>YZY STREAM</h1>
      <div id="clock" aria-live="polite" role="status">00:00:00 - 00/00/0000</div>
    </header>
<form id="subscribeForm">
  <label for="email">Join our mailing list:</label><br>
  <input type="email" id="email" name="email" required>
  <button type="submit">Subscribe</button>
</form>
<p id="responseMessage" style="margin-top: 10px; color: green;"></p>

<script>
document.getElementById("subscribeForm").addEventListener("submit", function(e) {
  e.preventDefault(); // prevent page reload

  const formData = new FormData(this);
  const messageBox = document.getElementById("responseMessage");

  fetch("subscribe.php", {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(data => {
    messageBox.textContent = data;
    this.reset(); // clear form
  })
  .catch(() => {
    messageBox.style.color = "red";
    messageBox.textContent = "Something went wrong. Please try again.";
  });
});
</script>

<p>We‚Äôll only email you with important updates.</p>
    <main>
      <section id="news-article">
        <h2>${title}</h2>
        ${articleHTML}
      </section>
    </main>

    <hr class="separator" />

    <footer class="footer">
      <p>&copy; 2025 | yzystream.com</p>
      <nav aria-label="Footer navigation">
        <a href="index.html">Home</a> | 
        <a href="untitled.html">[untitled]</a> | 
        <a href="faq.html">FAQ</a> | 
        <a href="privacy.html">Privacy Policy</a>
      </nav>
    </footer>
  </div>
</body>
</html>`;

        const blob = new Blob([finalHTML], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${safeTitle}.html`;
        a.click();

        status.textContent = '‚úÖ Generated and downloaded successfully!';
      } catch (err) {
        console.error(err);
        status.textContent = '‚ùå Failed to fetch and process page.';
      }
    }
  </script>
</body>
</html>
